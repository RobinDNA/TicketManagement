<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>注册</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap-switch.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/bootstrapValidator.min.js"></script>
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/bootstrap-switch.min.css">
    <link rel="stylesheet" href="/stylesheets/bootstrapValidator.min.css" />

    <script type="text/javascript">
        function registerUser(vote) {
            var arr = $('#registerForm').serializeArray();
            $.ajax({
                url: '/register?vote=' + vote,
                data: $.param(arr),
                type: 'post',
                dataType: 'text',
                success: function (msg) {
                    console.log('hello');
                    var jsonData = JSON.parse(msg);
                    console.log(msg);
                    console.log(jsonData.isRegisterSuccess);
                    if (jsonData.isRegisterSuccess != null && jsonData.isRegisterSuccess == true) {
                        console.log('redirect to ' + jsonData.locationUrl);
                        window.location.href = jsonData.locationUrl;
                    } else {
                        $('#divError').show();
                        $('#lblErrMsg').text(jsonData.errMsg);
                    }
                }
            })
        }
    </script>
</head>
<body>
    <form id="registerForm" action="/register" method="POST" class="form-horizontal">
        <div id="divError" class="form-group has-error">
            <label id="lblErrMsg" class="control-label" for="inputWarning1"></label>
        </div>
        <div class="col-lg-6">
            <label>手机号：</label>
            <div class="input-group">
                <input type="text" name="inputCellphoneNumber" id="inputCellphoneNumber" class="form-control" placeholder="手机号">
                <span class="input-group-btn">
                    <button type="button" name="btnVote" class="btn btn-default" value="sendSmsCode" onclick="registerUser('sendSmsCode')">发送</button>
                </span>
            </div>
        </div>
        <div class="col-lg-6">
            <label>验证码：</label>
            <div class="input-group">
                <input type="text" class="form-control" name="inputVerificationCode" id="inputVerificationCode" placeholder="手机收到的验证码">
            </div>
        </div>
        <div class="col-lg-6">
            <label>密 码：</label>
            <div class="input-group">
                <input type="password" class="form-control" name="inputPassword" id="inputPassword" placeholder="密 码">
            </div>
        </div>
        <div class="col-lg-6">
            <label>再次输入密码：</label>
            <div class="input-group">
                <input type="password" class="form-control" name="inputPasswordAgain" id="inputPasswordAgain" placeholder="再次输入密码">
            </div>
        </div>
        <div class="col-lg-6">
            <label>Email：</label>
            <div class="input-group">
                <input type="text" class="form-control" name="inputEmail" id="inputEmail" placeholder="Email">
            </div>
        </div>
        <div class="col-lg-6">
            <label>个人/企业：</label>
            <div class="input-group">
                <input type="checkbox" name="switch-state" id="switchState" checked data-on-text="个人" data-off-text="企业">
            </div>
        </div>
        <div class="col-lg-6">
            <label>地址：</label>
            <div class="input-group">
                <input type="text" class="form-control" name="inputAddress" id="inputAddress" placeholder="地址">
            </div>
        </div>
        <div class="col-lg-6" id="divCompanyName">
            <label>公司名称：</label>
            <div class="input-group">
                <input type="text" class="form-control" name="inputCompanyName" id="inputCompanyName" placeholder="公司名称">
            </div>
        </div>
        <div class="col-lg-6" id="divChineseName">
            <label>姓名：</label>
            <div class="input-group">
                <input type="text" class="form-control" name="inputChineseName" id="inputChineseName" placeholder="姓名">
            </div>
        </div>
        <div class="col-lg-6" id="divOrgCode">
            <label>机构代码：</label>
            <div class="input-group">
                <input type="text" class="form-control" name="inputOrganizationCode" id="inputOrganizationCode" placeholder="机构代码">
            </div>
        </div>
        <div class="col-lg-6" id="divBussinessLic">
            <label for="exampleInputFile">营业执照上传</label>
            <input type="file" id="inputBusinessLicences">
            <p class="help-block">上传企业营业执照，文件大小不超过400k。</p>
        </div>
        <div class="col-lg-6" id="divPersonId">
            <label for="exampleInputFile">身份证件上传</label>
            <input type="file" id="inputBusinessLicences">
            <p class="help-block">上传身份证，文件大小不超过400k。</p>
        </div>
        <div class="col-lg-6">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="button" class="btn btn-default" name="btnVote" value="register" onclick="registerUser('register')">注 册</button>
            </div>
        </div>
    </form>
    <script>
        $(function () {
            $("input[type=\"checkbox\"], input[type=\"radio\"]").not("[data-switch-no-init]").bootstrapSwitch();

            $("#divCompanyName").hide();
            $("#divOrgCode").hide();
            $("#divBussinessLic").hide();
            $("#divChineseName").show();
            $("#divPersonId").show();

            $('input[id="switch-state"]').on('switchChange.bootstrapSwitch', function (event, state) {
                if (state) {
                    $("#divCompanyName").hide();
                    $("#divOrgCode").hide();
                    $("#divBussinessLic").hide();
                    $("#divChineseName").show();
                    $("#divPersonId").show();
                }
                else {

                    $("#divCompanyName").show();
                    $("#divOrgCode").show();
                    $("#divBussinessLic").show();
                    $("#divChineseName").hide();
                    $("#divPersonId").hide();
                }

            });
        });

        $(document).ready(function () {
            $("#registerForm").bootstrapValidator({
                message: 'This value is not valid',
                feedbackIcons: {/*input状态样式图片*/
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                submitButtons: 'button[type="button"]',
                submitHandler: function (validator, form, submitButton) {
                    //console.log('1211111');
                    //var arr = $('#registerForm').serializeArray();
                    //alert('hello');
                    $.post(form.attr('action'), form.serialize(), function (result) {
                        // The result is a JSON formatted by your back-end
                        // I assume the format is as following:
                        //  {
                        //      valid: true,          // false if the account is not found
                        //      username: 'Username', // null if the account is not found
                        //  }
                        if (result.valid == true || result.valid == 'true') {
                            // You can reload the current location
                            //window.location.reload();

                            // Or use Javascript to update your page, such as showing the account name
                            // $('#welcome').html('Hello ' + result.username);
                        } else {
                            // The account is not found
                            // Show the errors
                            $('#divError').show();
                            $('#lblErrMsg').text(msg);
                            //$('#errors').html('The account is not found').removeClass('hide');

                            // Enable the submit buttons
                            $('#registerForm').bootstrapValidator('disableSubmitButtons', false);
                        }
                    }, 'json');
                },
                fields: {/*验证：规则*/
                    inputCellphoneNumber: {//验证input项：验证规则
                        message: '请检查手机号',

                        validators: {
                            notEmpty: {//非空验证：提示消息
                                message: '手机号不能为空'
                            },
                            stringLength: {
                                min: 11,
                                max: 11,
                                message: '请输入11位手机号码'
                            },
                            regexp: {
                                regexp: /^1[3|5|8]{1}[0-9]{9}$/,
                                message: '请输入正确的手机号码'
                            }
                        }
                    },
                    inputVerificationCode: {
                        message: '验证码无效',
                        validators: {
                            notEmpty: {
                                message: '验证码不能为空'
                            },
                            stringLength: {
                                min: 3,
                                max: 8,
                                message: '验证码长度必须在3到8之间'
                            }
                        }
                    },
                    inputPassword: {
                        message: '密码无效',
                        validators: {
                            notEmpty: {
                                message: '密码不能为空'
                            },
                            stringLength: {
                                min: 3,
                                max: 30,
                                message: '用户名长度必须在3到30之间'
                            },
                            identical: {//相同
                                field: 'inputPasswordAgain', //需要进行比较的input name值
                                message: '两次密码不一致'
                            },
                            different: {//不能和用户名相同
                                field: 'inputCellphoneNumber',//需要进行比较的input name值
                                message: '不能和手机号相同'
                            }
                        }
                    },
                    inputPasswordAgain: {
                        message: '密码无效',
                        validators: {
                            notEmpty: {
                                message: '用户名不能为空'
                            },
                            stringLength: {
                                min: 3,
                                max: 30,
                                message: '用户名长度必须在3到30之间'
                            },
                            identical: {//相同
                                field: 'inputPassword',
                                message: '两次密码不一致'
                            },
                            different: {//不能和用户名相同
                                field: 'inputCellphoneNumber',
                                message: '不能和手机号相同'
                            }
                        }
                    },
                    inputEmail: {
                        validators: {
                            notEmpty: {
                                message: '邮件不能为空'
                            },
                            emailAddress: {
                                message: '请输入正确的邮件地址如：123@qq.com'
                            }
                        }
                    }
                }
            })
        });
    </script>

</body>
</html>
